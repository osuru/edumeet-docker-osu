version: "3.3"

services:
# edumeet
  edumeet:
    env_file: .env
#    image: edumeet/edumeet:${TAG}
    image: node:$NODE_VER
    depends_on: 
      - redis
#      - coturn
#    build:
#      args:
#        - BASEDIR=${BASEDIR}
#        - EDUMEET=${EDUMEET}
#        - NODE_ENV=${NODE_ENV}
#        - SERVER_DEBUG=${SERVER_DEBUG}
#        - DEBUG=${SERVER_DEBUG}
#      context: ./
    restart: unless-stopped
    entrypoint: "/docker-entrypoint.sh"
    volumes:
      - ./docker-entrypoint.sh:/docker-entrypoint.sh
      - ./edumeet-osu:/opt/edumeet
      - ./configs/server:${BASEDIR}/${EDUMEET}/server/config
      - ./configs/app:${BASEDIR}/${EDUMEET}/server/public/config
#      - ./certs:${BASEDIR}/${EDUMEET}/server/certs
#      - ./certs/cert.pem:${BASEDIR}/${EDUMEET}/server/certs/cert.pem:ro
#      - ./certs/key.pem:${BASEDIR}/${EDUMEET}/server/certs/key.pem:ro
      - ./images:${BASEDIR}/${EDUMEET}/server/public/images
      - ./privacy:${BASEDIR}/${EDUMEET}/server/public/static/privacy
      - ./.well-known:${BASEDIR}/${EDUMEET}/server/public/.well-known
    ports:
    #  - "80:80"
       - "5443:5443"
    #  - "40000-49999:40000-49999/udp"
#    network_mode: "host"
    stdin_open: true
    tty: true
#  coturn:
#    image: michaelfig/coturns
#    build:
#      context: ./configs/coturn
#    network_mode: "host"
#    ports:
#      - 6443:443
#    environment:
#     - AUTH_SECRET=examplekey
#     - TLS_DIRECTORY=/certs
#    volumes:
#      - ./certs:/certs
#      - ./certs/cert.pem:/certs/tls.crt
#      - ./certs/key.pem:/certs/tls.key
#      - ./configs/coturn/turnserver.conf.in:/turnserver.conf.in:ro
  redis:
    image: redis
    #network_mode: "host"
    ports:
       - 6369:6379
    entrypoint: redis-server /usr/local/etc/redis/redis.conf
    restart: unless-stopped
    volumes:
      - ./configs/redis:/usr/local/etc/redis
